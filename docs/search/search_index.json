{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Sponsored Stacks transactions Transactions can be either signed by the user as a standard transaction or as a sponsored transactions. Sponsored transactions are only accepted by the Stacks blockchain when the transaction is additionally signed by the a second user, the sponsor. The sponsor pays for the transaction fees. Use cases The sponsored transactions are used for the following use cases: Send $NOT to many users Minting NFTs Transferring NFTs Block hacked user account In-Depth For more details, see In-Depth for users In-Depth for developers Vision There are ideas how to improve and extend sponsored transaction, see Paying in BTC or sBTC Transaction Bundles Support This project is kindly supported by the DeGrants Program .","title":"Sponsored Stacks transactions"},{"location":"#sponsored-stacks-transactions","text":"Transactions can be either signed by the user as a standard transaction or as a sponsored transactions. Sponsored transactions are only accepted by the Stacks blockchain when the transaction is additionally signed by the a second user, the sponsor. The sponsor pays for the transaction fees.","title":"Sponsored Stacks transactions"},{"location":"#use-cases","text":"The sponsored transactions are used for the following use cases: Send $NOT to many users Minting NFTs Transferring NFTs Block hacked user account","title":"Use cases"},{"location":"#in-depth","text":"For more details, see In-Depth for users In-Depth for developers","title":"In-Depth"},{"location":"#vision","text":"There are ideas how to improve and extend sponsored transaction, see Paying in BTC or sBTC Transaction Bundles","title":"Vision"},{"location":"#support","text":"This project is kindly supported by the DeGrants Program .","title":"Support"},{"location":"in-depth/in-depth-developers/","text":"In-Depth: Sponsored Transactions for Developers Sponsored transactions were added to the Stacks blockchain to enable developers and/or infrastructure operators to pay for users to call into their smart contracts, even if users do not hold STX to pay for fees. (See SIP-005 ). The process consists of two steps: 1) signing by user and 2) signing by sponsor Signing Transaction by User Sponsored transactions are build in the same way as normal transactions. The only difference is that fees are set to 0 and the sponsored flag is set to true. The sponsored transaction is then send to the user's wallet for confirmation. The wallet can't broadcast the transaction, instead it is returned to the app and needs to be handled separately. An example with @stacks/connect library looks like the following (see also send-many example ): const txOptions = {...}; txOptions.fee = 0; txOptions.sponsored = true; openContractCall({...txOptions, onFinish: (finishedTxData) => handleSignedSponsoredTransaction(finishTxData) } ) Signing Transaction by Sponsor The signed transaction is returned from the wallet as part of the finished transaction data. The authentication type of the transaction will be of type Sponsored data.stacksTransaction.auth.authType === AuthType.Sponsored; The serialized transaction ( data.txRaw ) can then be sent to a server for signing by the sponsor. There, the sponsor sets the fee for the transaction, add the sponsor's nonce and signs the transaction with the private key. An example using the javascript library @stacks/transactions on a server looks like the following (see also not-sponsoring example ): import {deserializeTransaction, sponsorTransaction} from '@stacks/transactions'; ... const transaction = deserializeTransaction(txRaw); const feeEstimate = await estimateTransactionFeeWithFallback(transaction, network); const sponsorNonce = nonce; // next nonce of sponsor account const sponsoredTx = await sponsorTransaction({ sponsorPrivateKey: env.SPONSOR_PRIVATE_KEY, transaction, network, fee, sponsorNonce: nonce, }); const result = await broadcastTransaction(sponsoredTx); Webservices for Sponsoring Transactions As mentioned above the transaction signing by sponsor usually happens on a server that holds the private key of the sponsor. There are two open source projects that implemented such a webservice that provide both the same API: Tx2 service : basic service that allows to sponsor send-many calls for $NOTHING, uses single sponsoring address. Xverse service : advanced service that allows to sponsor nft transfers, uses a randomly selected address from a list of sponsoring addresses. API Reference sponsor /v1/sponsor (POST) The request body contains the user signed transaction as json property tx . The transaction must be created as a sponsored transaction. The service will sign the transaction as the sponsor and broadcast it. Example Request: curl -X POST http://localhost:3000/v1/sponsor \\ -H \"Content-Type: application/json\" \\ -d '{\"tx\": \"feedc00d1...user-signed-transaction-hex\"}' Result: { \"txid\": \"c001c0de...tx-id\", \"rawTx\": \"feedc00d2...sponsored-transaction-hex\" } info /v1/info (GET) The request returns information about the service in JSON. The result is a list of addresses used by the service for sponsoring transactions. For tx2, the result contains also the minimum fees for NOT sponsoring and the balance of the sponsor. Example curl -X GET http://localhost:3000/v1/info' Result: { \"active\": \"true\", \"sponsor_addresses\": [\"SP1234...\", \"SP5678...\"] }","title":"In-Depth: Sponsored Transactions for Developers"},{"location":"in-depth/in-depth-developers/#in-depth-sponsored-transactions-for-developers","text":"Sponsored transactions were added to the Stacks blockchain to enable developers and/or infrastructure operators to pay for users to call into their smart contracts, even if users do not hold STX to pay for fees. (See SIP-005 ). The process consists of two steps: 1) signing by user and 2) signing by sponsor","title":"In-Depth: Sponsored Transactions for Developers"},{"location":"in-depth/in-depth-developers/#signing-transaction-by-user","text":"Sponsored transactions are build in the same way as normal transactions. The only difference is that fees are set to 0 and the sponsored flag is set to true. The sponsored transaction is then send to the user's wallet for confirmation. The wallet can't broadcast the transaction, instead it is returned to the app and needs to be handled separately. An example with @stacks/connect library looks like the following (see also send-many example ): const txOptions = {...}; txOptions.fee = 0; txOptions.sponsored = true; openContractCall({...txOptions, onFinish: (finishedTxData) => handleSignedSponsoredTransaction(finishTxData) } )","title":"Signing Transaction by User"},{"location":"in-depth/in-depth-developers/#signing-transaction-by-sponsor","text":"The signed transaction is returned from the wallet as part of the finished transaction data. The authentication type of the transaction will be of type Sponsored data.stacksTransaction.auth.authType === AuthType.Sponsored; The serialized transaction ( data.txRaw ) can then be sent to a server for signing by the sponsor. There, the sponsor sets the fee for the transaction, add the sponsor's nonce and signs the transaction with the private key. An example using the javascript library @stacks/transactions on a server looks like the following (see also not-sponsoring example ): import {deserializeTransaction, sponsorTransaction} from '@stacks/transactions'; ... const transaction = deserializeTransaction(txRaw); const feeEstimate = await estimateTransactionFeeWithFallback(transaction, network); const sponsorNonce = nonce; // next nonce of sponsor account const sponsoredTx = await sponsorTransaction({ sponsorPrivateKey: env.SPONSOR_PRIVATE_KEY, transaction, network, fee, sponsorNonce: nonce, }); const result = await broadcastTransaction(sponsoredTx);","title":"Signing Transaction by Sponsor"},{"location":"in-depth/in-depth-developers/#webservices-for-sponsoring-transactions","text":"As mentioned above the transaction signing by sponsor usually happens on a server that holds the private key of the sponsor. There are two open source projects that implemented such a webservice that provide both the same API: Tx2 service : basic service that allows to sponsor send-many calls for $NOTHING, uses single sponsoring address. Xverse service : advanced service that allows to sponsor nft transfers, uses a randomly selected address from a list of sponsoring addresses.","title":"Webservices for Sponsoring Transactions"},{"location":"in-depth/in-depth-developers/#api-reference","text":"","title":"API Reference"},{"location":"in-depth/in-depth-developers/#sponsor","text":"/v1/sponsor (POST) The request body contains the user signed transaction as json property tx . The transaction must be created as a sponsored transaction. The service will sign the transaction as the sponsor and broadcast it.","title":"sponsor"},{"location":"in-depth/in-depth-developers/#example","text":"Request: curl -X POST http://localhost:3000/v1/sponsor \\ -H \"Content-Type: application/json\" \\ -d '{\"tx\": \"feedc00d1...user-signed-transaction-hex\"}' Result: { \"txid\": \"c001c0de...tx-id\", \"rawTx\": \"feedc00d2...sponsored-transaction-hex\" }","title":"Example"},{"location":"in-depth/in-depth-developers/#info","text":"/v1/info (GET) The request returns information about the service in JSON. The result is a list of addresses used by the service for sponsoring transactions. For tx2, the result contains also the minimum fees for NOT sponsoring and the balance of the sponsor.","title":"info"},{"location":"in-depth/in-depth-developers/#example_1","text":"curl -X GET http://localhost:3000/v1/info' Result: { \"active\": \"true\", \"sponsor_addresses\": [\"SP1234...\", \"SP5678...\"] }","title":"Example"},{"location":"in-depth/in-depth-users/","text":"In-Depth: Sponsored Transactions for Users Sponsored transactions are defined in SIP-005 . The specification says that the user needs to sign the transaction first and the sponsor second. User flow Practically, the user visits an website (or dapp), connects the Stacks wallet and then initializes a transaction. The wallet shows the transactions as usual with post-conditions etc. However, the fees will be 0 STX for the user. Leather web extension (version v6.51.1) show 0 STX fees and an information text like this: The wallet sends the signed transaction back to the website. The signed transaction can now be forwarded to a signing service or an other user who sponsors the transaction. Currently, no Stacks wallet supports signing transactions as a sponsor. Instead, the developers of the website needs to take care of it. Benefits and Risks On one hand, sponsored transactions simplify the interaction with websites or apps that do not require the use of STX directly. Furthermore, users do not have to evaluate the current fee market and decide on the fees. On the other hand, sponsored transactions create a dependency between user and sponsor. If the sponsor fails to sign and broadcast the transaction correctly, the user's transaction is not confirmed until the sponsor resolves the issue. A bad acting sponsor can even block the user's wallet. See Block Hacked Accounts .","title":"In-Depth: Sponsored Transactions for Users"},{"location":"in-depth/in-depth-users/#in-depth-sponsored-transactions-for-users","text":"Sponsored transactions are defined in SIP-005 . The specification says that the user needs to sign the transaction first and the sponsor second.","title":"In-Depth: Sponsored Transactions for Users"},{"location":"in-depth/in-depth-users/#user-flow","text":"Practically, the user visits an website (or dapp), connects the Stacks wallet and then initializes a transaction. The wallet shows the transactions as usual with post-conditions etc. However, the fees will be 0 STX for the user. Leather web extension (version v6.51.1) show 0 STX fees and an information text like this: The wallet sends the signed transaction back to the website. The signed transaction can now be forwarded to a signing service or an other user who sponsors the transaction. Currently, no Stacks wallet supports signing transactions as a sponsor. Instead, the developers of the website needs to take care of it.","title":"User flow"},{"location":"in-depth/in-depth-users/#benefits-and-risks","text":"On one hand, sponsored transactions simplify the interaction with websites or apps that do not require the use of STX directly. Furthermore, users do not have to evaluate the current fee market and decide on the fees. On the other hand, sponsored transactions create a dependency between user and sponsor. If the sponsor fails to sign and broadcast the transaction correctly, the user's transaction is not confirmed until the sponsor resolves the issue. A bad acting sponsor can even block the user's wallet. See Block Hacked Accounts .","title":"Benefits and Risks"},{"location":"use-cases/block/","text":"Block hacked account Sponsored transactions have been seen in the wild to block a hacked account from doing any further transactions. This is possible due to the dependency between user and sponsor. When a third party (Alice) has access to the private key of the user's account, the user (Bob) can try to block their own account. The user can initiate a sponsored transaction with the sponsoring account using a nonce with a gap. This prevents that the user's sponsored transaction is confirmed by the network. The user account cannot send any transactions anymore. The third party could try to replace the transaction by higher fees. However, the sponsor can do the same. If the user uses a very high fee e.g. 1000x more than usual then it is very expensive for the 3rd party to submit a bad transaction because the 3rd party has to increase the fees even more. For the user the risk is smaller because the sponsor can get back their fees when the transaction in mempool expires after 256 tenures/bitcoin blocks (around 2 days). Example: Bob sends a sponsored transaction with nonce 100 and with sponsoring nonce 1 from a new sponsoring account and with fees 1000 STX. The first sponsoring account would be 0, not 1. The user's account is blocked. Alice replaces the sponsored transaction with a normal transaction with nonce 100 and with 1000.1 STX fees, e.g. to drain the account. Alice would get 1000 STX less if confirmed. Bob replaces the normal transaction with a sponsored transaction with 1001 STX fees and the same nonces with gap. After 256 tenures the sponsored transaction would expire and the sponsor account can re-use the 1001 STX reserved for the fees.","title":"Block hacked account"},{"location":"use-cases/block/#block-hacked-account","text":"Sponsored transactions have been seen in the wild to block a hacked account from doing any further transactions. This is possible due to the dependency between user and sponsor. When a third party (Alice) has access to the private key of the user's account, the user (Bob) can try to block their own account. The user can initiate a sponsored transaction with the sponsoring account using a nonce with a gap. This prevents that the user's sponsored transaction is confirmed by the network. The user account cannot send any transactions anymore. The third party could try to replace the transaction by higher fees. However, the sponsor can do the same. If the user uses a very high fee e.g. 1000x more than usual then it is very expensive for the 3rd party to submit a bad transaction because the 3rd party has to increase the fees even more. For the user the risk is smaller because the sponsor can get back their fees when the transaction in mempool expires after 256 tenures/bitcoin blocks (around 2 days). Example: Bob sends a sponsored transaction with nonce 100 and with sponsoring nonce 1 from a new sponsoring account and with fees 1000 STX. The first sponsoring account would be 0, not 1. The user's account is blocked. Alice replaces the sponsored transaction with a normal transaction with nonce 100 and with 1000.1 STX fees, e.g. to drain the account. Alice would get 1000 STX less if confirmed. Bob replaces the normal transaction with a sponsored transaction with 1001 STX fees and the same nonces with gap. After 256 tenures the sponsored transaction would expire and the sponsor account can re-use the 1001 STX reserved for the fees.","title":"Block hacked account"},{"location":"use-cases/minting-nfts/","text":"Minting NFTs A sponsoring service for minting NFTs is currently under development. It will demonstrate how project can help onboarding new users that do not have STX. More details will be published here once the service is completed.","title":"Minting NFTs"},{"location":"use-cases/minting-nfts/#minting-nfts","text":"A sponsoring service for minting NFTs is currently under development. It will demonstrate how project can help onboarding new users that do not have STX. More details will be published here once the service is completed.","title":"Minting NFTs"},{"location":"use-cases/send-many/","text":"Send $NOTHING to many users The website sendstx.com helps users to send STX and other tokens to many users with a single transaction. The site uses sponsored transactions. When sending $NOT tokens users can choose to pay transactions fees in $NOT. (They pay nothing). sendstx.com Explanation When the user chooses to pay in $NOT the sponsor address is added as a recipient of the send-many transaction. The amount is currently fixed and should be equivalent to the transactions fees in STX. The transaction is signed by the user as a sponsored transaction using Leather wallet (or other supported wallets). The returned signed transaction is send to the tx2.app server. The server verifies the transactions. If the transaction is eligible for sponsoring, the server account signs the transaction as sponsor with the keys of the sponsor address and then broadcasts the transaction. The following criteria are implemented for eligible sponsoring: must be a sponsored transaction must be a send-many transaction for $NOT must contain the sponsor address as recipient must send at least 1k $NOT to the sponsor The source code is available at github.com/friedger/stacks-not-sponsoring .","title":"Send $NOTHING to many users"},{"location":"use-cases/send-many/#send-nothing-to-many-users","text":"The website sendstx.com helps users to send STX and other tokens to many users with a single transaction. The site uses sponsored transactions. When sending $NOT tokens users can choose to pay transactions fees in $NOT. (They pay nothing).","title":"Send $NOTHING to many users"},{"location":"use-cases/send-many/#sendstxcom","text":"","title":"sendstx.com"},{"location":"use-cases/send-many/#explanation","text":"When the user chooses to pay in $NOT the sponsor address is added as a recipient of the send-many transaction. The amount is currently fixed and should be equivalent to the transactions fees in STX. The transaction is signed by the user as a sponsored transaction using Leather wallet (or other supported wallets). The returned signed transaction is send to the tx2.app server. The server verifies the transactions. If the transaction is eligible for sponsoring, the server account signs the transaction as sponsor with the keys of the sponsor address and then broadcasts the transaction. The following criteria are implemented for eligible sponsoring: must be a sponsored transaction must be a send-many transaction for $NOT must contain the sponsor address as recipient must send at least 1k $NOT to the sponsor The source code is available at github.com/friedger/stacks-not-sponsoring .","title":"Explanation"},{"location":"use-cases/transferring-nfts/","text":"Transferring NFTs A sponsoring service for transferring NFTs is maintained by Xverse. It allows users to move NFTs from accounts that do not hold any STX tokens. The service is available via the Xverse app.","title":"Transferring NFTs"},{"location":"use-cases/transferring-nfts/#transferring-nfts","text":"A sponsoring service for transferring NFTs is maintained by Xverse. It allows users to move NFTs from accounts that do not hold any STX tokens. The service is available via the Xverse app.","title":"Transferring NFTs"},{"location":"vision/sbtc/","text":"Paying Transaction fees in BTC and sBTC There are discussion how users can pay transaction fees in BTC and sBTC. See for example this forum post . Currently, there is no clear plan how this will be implemented. There does not yet exist a SIP for the idea to pay transaction fees in BTC or sBTC.","title":"Paying Transaction fees in BTC and sBTC"},{"location":"vision/sbtc/#paying-transaction-fees-in-btc-and-sbtc","text":"There are discussion how users can pay transaction fees in BTC and sBTC. See for example this forum post . Currently, there is no clear plan how this will be implemented. There does not yet exist a SIP for the idea to pay transaction fees in BTC or sBTC.","title":"Paying Transaction fees in BTC and sBTC"},{"location":"vision/transaction-bundles/","text":"Transaction Bundles Currently, sponsors need to find individual ways to receive compensation for sponsoring transactions. Furthermore, the compensation and the execution of the sponsored transaction might not happen at the same time. If one fails, either the sponsor or the user would loose the fees. There is a proposal about bundling two or more transactions into one atomic execution ( issue #4235 ). For sponsored transactions, a second transaction for compensation could be bundled with the original transaction so that both transactions are executed or both fail.","title":"Transaction Bundles"},{"location":"vision/transaction-bundles/#transaction-bundles","text":"Currently, sponsors need to find individual ways to receive compensation for sponsoring transactions. Furthermore, the compensation and the execution of the sponsored transaction might not happen at the same time. If one fails, either the sponsor or the user would loose the fees. There is a proposal about bundling two or more transactions into one atomic execution ( issue #4235 ). For sponsored transactions, a second transaction for compensation could be bundled with the original transaction so that both transactions are executed or both fail.","title":"Transaction Bundles"}]}